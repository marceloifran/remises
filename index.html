<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar sesión</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css"
        integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog=="
        crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@10.0.0/dist/sweetalert2.min.css">
    <meta name="theme-color" content="black">
</head>

<body>
    <div class="container mt-5">
        <div class="row justify-content-center">
            <div class="col-md-6">
                <h1 class="mb-4 text-center alert alert-info">Iniciar sesión</h1>
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="email" class="form-label">Correo Electrónico:</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>

                    <div class="mb-3">
                        <label for="password" class="form-label">Contraseña:</label>
                        <input type="password" class="form-control" id="password" required>
                    </div>

                    <button type="button" class="btn btn-primary" onclick="iniciarSesion()">Iniciar sesión</button>
                </form>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.7.1/firebase-firestore.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10.0.0/dist/sweetalert2.all.min.js"></script>

    <script>
        // Configurar la conexión con Firebase
        var firebaseConfig = {
            apiKey: "AIzaSyDMQMX2wrZ7X_ISg2K7z3xJKEl5Hsa_9sQ",
            authDomain: "remises-e97bb.firebaseapp.com",
            projectId: "remises-e97bb",
            storageBucket: "remises-e97bb.appspot.com",
            messagingSenderId: "497187806637",
            appId: "1:497187806637:web:e6fe9c603f4e0a82e39524",
            measurementId: "G-CHH2E5Y297"
        };

        // Inicializar Firebase
        firebase.initializeApp(firebaseConfig);

        // Función para iniciar sesión
        function iniciarSesion() {
            var email = document.getElementById("email").value;
            var password = document.getElementById("password").value;

            firebase.auth().signInWithEmailAndPassword(email, password)
                .then(function (userCredential) {
                    var user = userCredential.user;

                    // Verificar si el usuario está habilitado
                    firebase.firestore().collection("usuarios").doc(user.uid).get()
                        .then(function (doc) {
                            if (doc.exists) {
                                if (doc.data().deshabilitado) {
                                    // Si el usuario está deshabilitado, cerrar sesión
                                    firebase.auth().signOut().then(function () {
                                        Swal.fire({
                                            icon: 'error',
                                            title: 'Cuenta deshabilitada',
                                            text: 'Tu cuenta ha sido deshabilitada. Contacta al administrador.',
                                        });
                                    }).catch(function (error) {
                                        console.error("Error al cerrar sesión: ", error);
                                    });
                                } else {
                                    // Redirigir al usuario a la página principal
                                    window.location.href = "usuarios.html";
                                }
                            } else {
                                Swal.fire({
                                    icon: 'error',
                                    title: 'Error',
                                    text: 'No se encontraron detalles del usuario.',
                                });
                            }
                        })
                        .catch(function (error) {
                            console.error("Error al obtener información del usuario: ", error);
                        });
                })
                .catch(function (error) {
                    Swal.fire({
                        icon: 'error',
                        title: 'Error de inicio de sesión',
                        text: 'Correo electrónico o contraseña incorrectos.',
                    });
                });
        }
    </script>
</body>

</html>
